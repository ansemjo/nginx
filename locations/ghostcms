set $ghosthome "/var/lib/ghost";
set $ghosttheme "beautiful-ghost";
set $ghostsocket http://unix:$ghosthome/ghost.sock:;

error_page 403 404 /404/;

location ~ /(\.ht|README|LICENSE) {
    deny all; }

location /content/images {
    root $ghosthome;
    expires max; }

location /assets {
    root $ghosthome/content/themes/$ghosttheme;
    expires max; }

location /public {
    root $ghosthome/core/built;
    expires max; }

location /ghost/scripts {
    alias $ghosthome/core/built/scripts;
    expires max; }

location / {
    try_files $uri @ghost;
}

location @ghost {
    proxy_cache PROXY;
    proxy_ignore_headers X-Accel-Expires Expires Cache-Control;
    proxy_pass $ghostsocket;
}

location ~ ^/(?:ghost|signout|p/) {
    proxy_cache off;
    proxy_pass $ghostsocket;
}
