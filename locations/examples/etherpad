# see: https://github.com/ether/etherpad-lite/wiki/How-to-put-Etherpad-Lite-behind-a-reverse-Proxy#hosted-at--with-friendly-urls-for-pads

# TODO: try to use set $variable $value for proxy pass here ?

# Allow normal files to pass through
location ~ ^/(locales/|locales.json|admin/|static/|pluginfw/|javascripts/|socket.io/|ep/|minified/|api/|ro/|error/|jserror/|favicon.ico|robots.txt) {
    proxy_buffering off;
    proxy_pass http://etherpad-lite;
}

# Redirect to force /p/* URLs to the friendly version
location /p/ {
    rewrite ^/p/(.*) /$1 redirect;
}

# Match the home page
location ~ ^/$ {
    proxy_buffering off;
    proxy_pass http://etherpad-lite;
}

# Handle pad URLs here
location / {
    proxy_buffering off;
    proxy_pass http://etherpad-lite/p/;
    proxy_redirect / /p/;
    proxy_pass_header Server;
    include parameters/proxy;
}
